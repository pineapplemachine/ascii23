name: Run ascii23 tests and benchmark
run-name: ${{ github.actor }} is running ascii23 tests and benchmark
on:
  push:
    branches: [master]
  pull_request:
    types: [opened, reopened, synchronize]
jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - name: git checkout
        uses: actions/checkout@v3
        
      - name: install gcc
        uses: Dup4/actions-setup-gcc@v1
        with:
          version: latest
          
      - name: install cppcheck
        run: sudo apt-get install cppcheck
        
      - name: make tests
        run: |
          make test_impl
          make test_header
          make test_lib
          
      - name: make benchmark
        run: |
          make bench_impl
          
      - name: run implementation test
        run:
          ./bin/test_impl
      - name: run header-only test
        run:
          ./bin/test_header
      - name: run static linking test
        run:
          ./bin/test_lib
          
      - name: run benchmark
        run: |
          ./bin/bench_impl
